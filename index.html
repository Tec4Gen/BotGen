<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <meta charset="UTF-8">
    <title>Title</title>
</head>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">

    <a class="navbar-brand" href="#">
        <img src="https://img.icons8.com/dusk/64/000000/bot.png">
        botGen
    </a>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">


        <div class="btn-group navbar-nav mr-auto">
            <div type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                 aria-expanded="false">
                <i class="fa fa-plus-circle" aria-hidden="true"></i>
                Добавить
            </div>

            <div class="dropdown-menu">
                <a class="dropdown-item" onclick="addBlock();">Меню</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" onclick="addBlockKeyWords();">Ключевые слова</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" onclick="addBlockStaticWord();">Статические слова</a>
            </div>
        </div>
        <div class="btn-group navbar-nav " style="margin-right:50px;">
            <button class="btn btn-success" id="Save__config" type="submit">Сохранить настройки</button>
        </div>

        <ul class="navbar-nav my-2 my-lg-0">
            <li class="nav-item">
                <a class="nav-link" href="#">Выйти</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Профиль</a>
            </li>
        </ul>

    </div>

</nav>

<nav class="col-md-2 d-none d-md-block bg-light sidebar float-right mt-4">
    <div class="sidebar-sticky">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="feather feather-home">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Dashboard <span class="sr-only">(current)</span>
                </a>
            </li>
        </ul>

        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Saved reports</span>
            <a class="d-flex align-items-center text-muted" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="feather feather-plus-circle">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="16"></line>
                    <line x1="8" y1="12" x2="16" y2="12"></line>
                </svg>
            </a>
        </h6>
        <ul class="nav flex-column mb-2">
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="feather feather-file-text">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Current month
                </a>
            </li>
        </ul>
    </div>
</nav>
<body>
<div id="main" style="width: 83.23%; height: 1000px">
    <!--    <div class="row">-->

    <!--            <div class="col-md-4" id="1">-->
    <!--                <div class="card border-dark mb-3" style="max-width: 18rem;">-->
    <!--                    <div class="card-header">Введите название меню</div>-->
    <!--                    <div class="form-group">-->
    <!--                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="1"  placeholder="">Введите название меню</textarea>-->
    <!--                    </div>-->

    <!--                    <div class="up_bar_outside" align="left">-->

    <!--                        <div class="button_close_outside" >-->
    <!--                            <button type="button" class="close" aria-label="Close">-->
    <!--                                <span aria-hidden="true">&times;</span>-->
    <!--                            </button>-->
    <!--                        </div>-->

    <!--                        <div class="number_button" align="left">-->
    <!--                            <button type="button" class="btn btn-outline-danger">1</button>-->
    <!--                        </div>-->

    <!--                    </div>-->

    <!--                    <div class="card-body text-dark">-->
    <!--                        <div class="card border-dark mb-3" style="max-width: 16rem;">-->

    <!--                            <div class="button_close_outside" >-->
    <!--                                <button type="button" class="close" aria-label="Close">-->
    <!--                                    <span aria-hidden="true">&times;</span>-->
    <!--                                </button>-->
    <!--                            </div>-->

    <!--                            <div class="header" align="center">-->
    <!--                                <input name="menu_name" type="text" placeholder="Введите название пункта" />-->
    <!--                                <input class="form-control" name="menu_name" id="menu_name" type="text" placeholder="Введите название пункта">-->
    <!--                            </div>-->


    <!--                            <div class="number_button" align="right">-->
    <!--                                <button type="button" class="btn btn-outline-primary">1</button>-->
    <!--                            </div>-->


    <!--                        </div>-->

    <!--                    </div>-->

    <!--                    <div class="bnt" align="right">-->
    <!--                        <div class="add_button_outside" >-->
    <!--                            <button type="button" class="btn btn-success" aria-haspopup="true" aria-hidden="true">+</button>-->
    <!--                        </div>-->
    <!--                    </div>-->

    <!--                </div>-->
    <!--            </div>-->

    <!--            <div class="col-md-4" id="2">-->
    <!--                <div class="card border-dark mb-3" style="max-width: 18rem;">-->
    <!--                    <div class="card-header">Список ключевых слов</div>-->
    <!--                    <div class="up_bar_outside" align="left">-->

    <!--                        <div class="button_close_outside" >-->
    <!--                            <button type="button" class="close" aria-label="Close">-->
    <!--                                <span aria-hidden="true">&times;</span>-->
    <!--                            </button>-->
    <!--                        </div>-->

    <!--                        <div class="number_button" align="left">-->
    <!--                            <button type="button" class="btn btn-outline-danger">1</button>-->
    <!--                        </div>-->

    <!--                    </div>-->
    <!--                    <div class="card-body text-dark">-->

    <!--                        <div class="card border-dark mb-3" style="max-width: 16rem;">-->

    <!--                            <div class="button_close_outside" >-->
    <!--                                <button type="button" class="close" aria-label="Close">-->
    <!--                                    <span aria-hidden="true">&times;</span>-->
    <!--                                </button>-->
    <!--                            </div>-->

    <!--                            <span align = "center">Введите слово</span>-->
    <!--                            <div class="header" align="center">-->

    <!--                                <button type="button" class="close" aria-label="Close">-->
    <!--                                    <span aria-hidden="true">&times;</span>-->
    <!--                                </button>-->
    <!--                                <input class="form-control" name="key_word" id="key_word" type="text" placeholder="Введите слово">-->
    <!--                                <div class="number_button" align="right">-->
    <!--                                    <button type="button" class="btn btn-outline-primary">1</button>-->
    <!--                                </div>-->
    <!--                            </div>-->


    <!--                            <div class="bnt" align="center">-->
    <!--                                <div class="add_button_outside" >-->
    <!--                                    <button type="button" class="btn btn-success" aria-haspopup="true" aria-hidden="true">+</button>-->
    <!--                                </div>-->
    <!--                            </div>-->

    <!--                        </div>-->

    <!--                    </div>-->

    <!--                    <div class="bnt" align="right">-->
    <!--                        <div class="add_button_outside" >-->
    <!--                            <button type="button" class="btn btn-success" aria-haspopup="true" aria-hidden="true">+</button>-->
    <!--                        </div>-->
    <!--                    </div>-->

    <!--                </div>-->

    <!--            </div>-->
    <!--        <div class="col-md-4">-->
    <!--            <div class="card border-dark mb-3" style="max-width: 18rem;">-->
    <!--                <div class="card-header">Список статических слов</div>-->
    <!--                <div class="up_bar_outside" align="left">-->

    <!--                    <div class="button_close_outside" >-->
    <!--                        <button type="button" class="close" aria-label="Close">-->
    <!--                            <span aria-hidden="true">&times;</span>-->
    <!--                        </button>-->
    <!--                    </div>-->

    <!--                    <div class="number_button" align="left">-->
    <!--                        <button type="button" class="btn btn-outline-danger">1</button>-->
    <!--                    </div>-->

    <!--                </div>-->
    <!--                <div class="card-body text-dark">-->
    <!--                    <div class="card border-dark mb-3" style="max-width: 16rem;">-->

    <!--                        <div class="button_close_outside" >-->
    <!--                            <button type="button" class="close" aria-label="Close">-->
    <!--                                <span aria-hidden="true">&times;</span>-->
    <!--                            </button>-->
    <!--                        </div>-->

    <!--                        <div class="header" align="center">-->
    <!--                            <input name="static_word" type="text" placeholder="Введите слово" />-->
    <!--                            <input class="form-control" name="static_word" id="static_word" type="text" placeholder="Введите слово">-->
    <!--                        </div>-->

    <!--                        <div class="number_button" align="right">-->
    <!--                            <button type="button" class="btn btn-outline-primary">1</button>-->
    <!--                        </div>-->

    <!--                    </div>-->

    <!--                </div>-->

    <!--                <div class="bnt" align="right">-->
    <!--                    <div class="add_button_outside" >-->
    <!--                        <button type="button" class="btn btn-success" aria-haspopup="true" aria-hidden="true">+</button>-->
    <!--                    </div>-->
    <!--                </div>-->

    <!--            </div>-->

    <!--    </div>-->
</div>


</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src='ShowLS.js' type='text/javascript'></script>
<script src='blockGen.js' type='text/javascript'></script>
<script type='text/javascript'>
    ////////canvas//////////
    // var canvas = document.createElement('canvas');
    // div = document.getElementById('main');
    // canvas.id     = "CursorLayer";
    // canvas.width  = 1224;
    // canvas.height = 768;
    // canvas.style.zIndex   = -8;
    // canvas.style.position = "absolute";
    // canvas.style.border   = "1px solid";
    // div.appendChild(canvas);
//window.onload = function f(e) {
        

    let
        docking = '',
        count = 0,
        countMenuItem = 0,
        countMenuItemKey = 0,
        isClicked = 0,
        number = 0,
        countOfDeleted = 0;


    var coutMainBlocks = 0,
        coutSubMenu_MainBlock = 0,
        countKeyWord_Block = 0,
        amountSubMenuKeyword=0,
        countSubMenuKeyWord = -1,
        blockCount = -1,
        coutKeyWord = 0,
        amountStaticWord = 0,
        JSONinfo,
        gg,
        countStaticBlock = 0;

    let info = {
        MainBlocks: {
            Main_block_count: coutMainBlocks,
            // MainBlock_number: {
            //     Name_Menu: "MenuName",
            //     SubMenu_count: coutSubMenu_MainBlock,
            //     SubMenu_MainBlock_number: {
            //         name_SubMenu: "SubMenuName",
            //     }
            //
            // }
        },

        KeyWordBlocks: {
            KeyWord_Block_count: countKeyWord_Block,
            SubMenuKeyword_count:amountSubMenuKeyword,
            Title_Keywords_Block: "",
            //SubMenuKeyWord_count: coutSubMenuKeyWord,
            // SubMenu_KeyWordBlock_number: {
            //     KeyWord: "Word",
            // },
        },

        StaticWordBlocks: {
            Static_Blocks_count: countStaticBlock,
            Title_StaticWordBlocks: "",
            SubMenuStaticWord: {
                StaticWord_count: amountStaticWord,
                //     StaticWord:"Word"
            },
        }

    };
    let save_1= {
        MainBlocks: {
            Main_block_count: coutMainBlocks,
        },

        KeyWordBlocks: {
            KeyWord_Block_count: countKeyWord_Block,
            SubMenuKeyword_count:amountSubMenuKeyword,
            Title_Keywords_Block: "",

        },

        StaticWordBlocks: {
            Static_Blocks_count: countStaticBlock,
            Title_StaticWordBlocks: "",
            SubMenuStaticWord: {
                StaticWord_count: amountStaticWord,

            },
        }
    };
    // Это просто ахуенно!

    $(`#Save__config`).click(function () {
        info = JSON.parse(JSON.stringify(save_1));
        let i = 0;
        if (blockCount >= 0) {

            $.each($('.main_menu'), function (index, value) {
                coutMainBlocks += 1;
                console.log(1);
                info.MainBlocks["MainBlock_" + index] = {
                    Title_Menu: $(this).val(),
                    Position: $(`#blockMenu-${index}`).position()
                };


                console.log(index + ':' + $(`#menuName-blockMenu-${index}`).val());
                $('input', $(`#containerMenu-blockMenu-${index}`)).each(function () {
                    coutSubMenu_MainBlock += 1;

                    let temp = {};
                    temp["SubMenu_MainBlock_" + i] = {Title_SubMenu: $(this).val()};
                    Object.assign(info.MainBlocks["MainBlock_" + index], temp);// <------FIX
                    i += 1;

                });
                let temp = {SubMenu_count: coutSubMenu_MainBlock};
                Object.assign(info.MainBlocks["MainBlock_" + index], temp);
                coutSubMenu_MainBlock = 0;
                i = 0;

            });
            info.MainBlocks.Main_block_count = coutMainBlocks;
            coutMainBlocks = 0;
        }

        if (maxKeyWordsBlock === 0) {
            info.KeyWordBlocks.KeyWord_Block_count=1;
            info.KeyWordBlocks.Title_Keywords_Block = $('#menuName-blockMenuKey-0').val();
            info.KeyWordBlocks.Position = $(`#blockMenuKey-0`).position();
            if (countSubMenuKeyWord >= 0) {
                countKeyWord_Block +=1;

                $.each($('.header_key'), function (index, value) {
                    amountSubMenuKeyword+=1;
                    let realID=this.id.split('-')[2];

                    info.KeyWordBlocks["SubMenu_KeyWordBlock_" + index] = {};
                    $('input', $(`#ContainerKeyWords-SubMenuKeyWords-${realID}`)).each(function () {

                        coutKeyWord += 1;
                        let word = $(this).val();
                        gg=word;
                        let temp = {};
                        temp["KeyWord_" + i] = word;
                        Object.assign(info.KeyWordBlocks["SubMenu_KeyWordBlock_" + index], temp);
                        i += 1;

                    });
                    let temp = {};
                    temp["count_KeyWordThisBlock"]=coutKeyWord;
                    Object.assign(info.KeyWordBlocks["SubMenu_KeyWordBlock_" + index],temp);
                    coutKeyWord=0;
                    info.KeyWordBlocks.KeyWord_Block_count = countKeyWord_Block;
                    i = 0;
                });
                info.KeyWordBlocks.SubMenuKeyword_count=amountSubMenuKeyword;
                amountSubMenuKeyword=0;
                countKeyWord_Block = 0;
            }
        }
        if (maxStaticWordsBlock === 0) {
            countStaticBlock += 1;
            i = 0;
            info.StaticWordBlocks.Position = $(`#blockMenuStatic-0`).position();
            info.StaticWordBlocks.Title_StaticWordBlocks = $('#menuName-blockMenuStatic-0').val();
            if (countStaticWord >= 0) {
                info.StaticWordBlocks.Static_Blocks_count = countStaticBlock;

                $('input', $(`#ContainerStaticWords`)).each(function (index) {
                    amountStaticWord += 1;
                    let word = $(this).val();
                    info.StaticWordBlocks.SubMenuStaticWord['StaticWord_' + index] = word;
                });
                info.StaticWordBlocks.SubMenuStaticWord.StaticWord_count = amountStaticWord;
            }
            amountStaticWord = 0;
        }
        countStaticBlock = 0;

        JSONinfo=JSON.stringify(info);
        localStorage.setItem("config",JSONinfo);
    });

    function addBlock() {

        //получаем новый id
        blockCount += 1;
        const newId = blockCount;


        console.log('blockCount', blockCount);

        console.log('newId', newId);

        //создаем блок
        addBlockMenu("#main", "blockMenu-" + newId);

        //вешаем на него двежение и перерисовку стрелок
        $(`#blockMenu-${newId}`).draggable({
            containment: "#main",
            scroll: false,
        });

        $(`#addItemMenu-blockMenu-${newId}`).click(function (e) {

            let num = e.currentTarget.id.split('-')[2];
            countMenuItem += 1;
            console.log('countMenuItem', countMenuItem);
            isClicked = 0;


            addItemInMenu('#containerMenu-blockMenu-' + num, 'menuItem-' + countMenuItem);

            $(`#remove-menuItem-${countMenuItem}`).click(function (e) {

                console.log('countMenuItem remove', countMenuItem);
                e.currentTarget.parentElement.parentElement.parentElement.remove();
            });

            ///Вешаем обработчик возможно пристыкавываетля
            $(`#addArrowBTN-menuItem-${countMenuItem}`).click(function (e) {
                docking = e.currentTarget.id;
            });

        });

        $(`#remove-blockMenu-${newId}`).click(function (e) {

            countOfDeleted += 1;
            console.log('blockCount remove', blockCount);
            console.log('countMenuItem remove', countMenuItem);
            e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();
        });

        //Вешаем обработчик возможно пристыковыемого
        $(`#shluz-blockMenu-${newId}`).click(function (e) {

            let id2 = e.currentTarget.attributes.id.nodeValue;
            /*      console.log(e);*/
            if (docking != null || docking != "") {

                console.log(docking);

                if (isClicked == 0) {
                    count += 1;
                    isClicked = 1;
                }


                let num = docking.split('-')[2];
                let num2 = e.currentTarget.id.split('-')[2];

                //если у менюшкт нет номера
                if ($('#shluz-blockMenu-' + num2)[0].innerText == '') {

                    $('#addArrowBTN-menuItem-' + num)[0].innerText = count - number - countOfDeleted;

                    $('#shluz-blockMenu-' + num2)[0].innerText = count - number - countOfDeleted;


                    console.log($('#shluz-blockMenu-' + num2)[0].innerText);
                    console.log($('#addArrowBTN-menuItem-' + num)[0].innerText);

                }
                //если у менюшки есть номер
                else {

                    let count1 = $('#shluz-blockMenu-' + num2)[0].innerText;
                    console.log(count1);

                    $('#addArrowBTN-menuItem-' + num)[0].innerText = count1;

                    number += 1;


                    console.log($('#shluz-blockMenu-' + num2)[0].innerText);
                    console.log($('#addArrowBTN-menuItem-' + num)[0].innerText);

                }

                info.block_1 = num;
                info.block_2 = num2;

            }

            console.log(info);

        });
    }

    /**
     ////////////////////////////////////////////////////////////////////////
     //              **** Добавление меню ключевых слов****                //
     ////////////////////////////////////////////////////////////////////////
     */
        //let blockCountKey=0; выпилил и заменил ,1, т.к блок всегда один
    let countOfDeletedKey = 0;
    let countKeyword = -1; //Ключевые слова
   // let countSubMenuKeyWord = -1;
    let blockCountKey = 0;
    let maxKeyWordsBlock = -1;

    function addBlockKeyWords() {

        //Если блока нет создадим
        if (maxKeyWordsBlock == -1) {
            console.log('blockCountKey', 0);
            maxKeyWordsBlock = 0;
            addBlockMenuKey("#main", "blockMenuKey-" + 0);

            //вешаем на него двежение
            $(`#blockMenuKey-${0}`).draggable({
                containment: "#main",
                scroll: false,
            });

        }


        $(`#addItemMenu-blockMenuKey-${0}`).click(function (e) {
            countSubMenuKeyWord += 1;
            addSubMenuKeyWord('#ContainerSubMenuKeyWord', 'SubMenuKeyWords-' + countSubMenuKeyWord);
            console.log('countSubMenuKeyWord', countSubMenuKeyWord);


            $(`#addKeyWord-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];
                console.log(numID);
                countKeyword += 1;
                addWordKey('#ContainerKeyWords-SubMenuKeyWords-' + numID, 'KeyWords-' + countKeyword);
                console.log('KeyWords add', countSubMenuKeyWord);


                $(`#remove-KeyWords-${countKeyword}`).click(function (e) {
                    let numID = e.currentTarget.id.split('-')[2];

                    console.log('KeyWords remove', numID);
                    e.currentTarget.parentElement.parentElement.remove();


                });
            });
            $(`#remove-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];

                console.log('KeyWords remove', numID);
                e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();


            });

            // ///Вешаем обработчик возможно пристыкавываетля
            // $(`#addArrowBTN-menuItem-${countKeyword}`).click(function (e) {
            //     docking = e.currentTarget.id;
            // });

        });

        //Вешаем обработчик возможно пристыкавываетля
        $(`#addArrowBTN-menuItemKey-${countMenuItemKey}`).click(function (e) {
            docking = e.currentTarget.id;
        });

        $(`#remove-blockMenuKey-${0}`).click(function (e) {
            maxKeyWordsBlock = -1;
            countOfDeletedKey += 1;
            console.log('blockCountKey remove', 0);
            e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();
        });


        // //Вешаем обработчик возможно пристыковыемого
        // $(`#shluz-blockMenKey-${1}`).click(function (e) {
        //
        //   let id2 = e.currentTarget.attributes.id.nodeValue;
        //   /*      console.log(e);*/
        //   if(docking != null || docking !="" ){
        //
        //     console.log(docking);
        //
        //     if (isClicked==0){
        //       count+=1;
        //       isClicked=1;
        //     }
        //
        //
        //     let num = docking.split('-')[2];
        //     let num2=e.currentTarget.id.split('-')[2];
        //
        //     //если у менюшкт нет номера
        //     if ($('#shluz-blockMenuKey-'+num2)[0].innerText == '') {
        //
        //       $('#addArrowBTN-menuItemKey-'+num)[0].innerText = count-number-countOfDeleted;
        //
        //       $('#shluz-blockMenuKey-'+num2)[0].innerText = count-number-countOfDeleted;
        //
        //
        //       console.log($('#shluz-blockMenuKey-'+num2)[0].innerText);
        //       console.log($('#addArrowBTN-menuItemKey-'+num)[0].innerText);
        //
        //     }
        //     //если у менюшки есть номер
        //     else {
        //
        //       let count1 = $('#shluz-blockMenuKey-'+num2)[0].innerText;
        //       console.log(count1);
        //
        //       $('#addArrowBTN-menuItemKey-'+num)[0].innerText = count1;
        //
        //       number+=1;
        //
        //
        //       console.log($('#shluz-blockMenuKey-'+num2)[0].innerText);
        //       console.log($('#addArrowBTN-menuItemKey-'+num)[0].innerText);
        //
        //     }
        //
        //     info.block_1=num;
        //     info.block_2=num2;
        //
        //   }
        //
        //   console.log(info);
        //
        // });
    }

    /**
     ////////////////////////////////////////////////////////////////////////
     //              **** Добавление меню статических слов****             //
     ////////////////////////////////////////////////////////////////////////
     */

        //let blockCountKey=0; выпилил и заменил ,1, т.к блок всегда один
    let countDeletedStatic = 0;
    let countStaticWord = -1; //Ключевые слова

    var maxStaticWordsBlock = -1;

    function addBlockStaticWord() {

        //создаем блок
        if (maxStaticWordsBlock === -1) {
            console.log('blockCountStatic', 0);
            maxStaticWordsBlock = 0;
            addBlockMenuStaticKey("#main", "blockMenuStatic-" + 0);

            //вешаем на него двежение
            $(`#blockMenuStatic-${0}`).draggable({
                containment: "#main",
                scroll: false,
            });

        }
        $(`#addItemMenu-blockMenuStatic-${0}`).click(function (e) {
            countStaticWord += 1;
            console.log('countStaticWord', countStaticWord);
            addStaticWords('#ContainerStaticWords', 'StaticWords-' + countStaticWord);


            $(`#remove-StaticWords-${countStaticWord}`).click(function (e) {
                console.log('StaticWords remove', countStaticWord);
                countStaticWord -= 1;
                e.currentTarget.parentElement.parentElement.remove();
            });

            ///Вешаем обработчик возможно пристыкавываетля
            $(`#addArrowBTN-menuItem-${countKeyword}`).click(function (e) {
                docking = e.currentTarget.id;
            });

        });

        //Вешаем обработчик возможно пристыкавываетля
        $(`#addArrowBTN-menuItemKey-${countMenuItemKey}`).click(function (e) {
            docking = e.currentTarget.id;
        });

        $(`#remove-blockMenuStatic-${0}`).click(function (e) {
            maxStaticWordsBlock = 0;
            countDeletedStatic += 1;
            console.log('blockStaticWord remove', 1);
            e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();
        });

        // //Вешаем обработчик возможно пристыковыемого
        // $(`#shluz-blockMenKey-${1}`).click(function (e) {
        //
        //   let id2 = e.currentTarget.attributes.id.nodeValue;
        //   /*      console.log(e);*/
        //   if(docking != null || docking !="" ){
        //
        //     console.log(docking);
        //
        //     if (isClicked==0){
        //       count+=1;
        //       isClicked=1;
        //     }
        //
        //
        //     let num = docking.split('-')[2];
        //     let num2=e.currentTarget.id.split('-')[2];
        //
        //     //если у менюшкт нет номера
        //     if ($('#shluz-blockMenuKey-'+num2)[0].innerText == '') {
        //
        //       $('#addArrowBTN-menuItemKey-'+num)[0].innerText = count-number-countOfDeleted;
        //
        //       $('#shluz-blockMenuKey-'+num2)[0].innerText = count-number-countOfDeleted;
        //
        //
        //       console.log($('#shluz-blockMenuKey-'+num2)[0].innerText);
        //       console.log($('#addArrowBTN-menuItemKey-'+num)[0].innerText);
        //
        //     }
        //     //если у менюшки есть номер
        //     else {
        //
        //       let count1 = $('#shluz-blockMenuKey-'+num2)[0].innerText;
        //       console.log(count1);
        //
        //       $('#addArrowBTN-menuItemKey-'+num)[0].innerText = count1;
        //
        //       number+=1;
        //
        //
        //       console.log($('#shluz-blockMenuKey-'+num2)[0].innerText);
        //       console.log($('#addArrowBTN-menuItemKey-'+num)[0].innerText);
        //
        //     }
        //
        //     info.block_1=num;
        //     info.block_2=num2;
        //
        //   }
        //
        //   console.log(info);
        //
        // });
    }
    $(document).ready(function(){
        let JSONparse=JSON.parse(localStorage.getItem("config"));



            let countMainBlock=JSONparse.MainBlocks.Main_block_count;
            for (let index =0;index<countMainBlock;index++) {
                let MainBlock_X=JSONparse.MainBlocks["MainBlock_" + index].Position["left"];
                let MainBlock_Y=JSONparse.MainBlocks["MainBlock_" + index].Position["top"];
                const newId=index;
                const newIDSubmenu=JSONparse.MainBlocks["MainBlock_" + newId].SubMenu_count;
                blockCount+=1;
                addBlockMenu("#main","blockMenu-"+newId,MainBlock_X,MainBlock_Y);

                //вешаем на него двежение и перерисовку стрелок
                $(`#blockMenu-${newId}`).draggable({
                    containment: "#main",
                    scroll: false,
                });
                for (let j=0;j < newIDSubmenu;j++){
                    countMenuItem += 1;
                    addItemInMenu('#containerMenu-blockMenu-' + newId, 'menuItem-' + countMenuItem);
                    $(`#remove-menuItem-${countMenuItem}`).click(function (e) {

                        console.log('countMenuItem remove', countMenuItem);
                        e.currentTarget.parentElement.parentElement.parentElement.remove();
                    });


                }
                $(`#addItemMenu-blockMenu-${newId}`).click(function (e) {

                    let num = e.currentTarget.id.split('-')[2];
                    countMenuItem += 1;
                    console.log('countMenuItem', countMenuItem);
                    isClicked = 0;


                    addItemInMenu('#containerMenu-blockMenu-' + num, 'menuItem-' + countMenuItem);

                    $(`#remove-menuItem-${countMenuItem}`).click(function (e) {

                        console.log('countMenuItem remove', countMenuItem);
                        e.currentTarget.parentElement.parentElement.parentElement.remove();
                    });

                    ///Вешаем обработчик возможно пристыкавываетля
                    $(`#addArrowBTN-menuItem-${countMenuItem}`).click(function (e) {
                        docking = e.currentTarget.id;
                    });
                });

                $(`#remove-blockMenu-${newId}`).click(function (e) {

                    countOfDeleted += 1;
                    console.log('blockCount remove', blockCount);
                    console.log('countMenuItem remove', countMenuItem);
                    e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();
                });
            }


        let KeyBlock_X = JSONparse.KeyWordBlocks.Position["left"];
        let KeyBlock_Y = JSONparse.KeyWordBlocks.Position["top"];
        const newId = 0;
        const newIDSubmenu = JSONparse.KeyWordBlocks.SubMenuKeyword_count;
        if (JSONparse.KeyWordBlocks.KeyWord_Block_count == 1) {
            console.log('this', newIDSubmenu);
            console.log('blockCountKey', 0);
            maxKeyWordsBlock = 0;
            addBlockMenuKey("#main", "blockMenuKey-" + 0, KeyBlock_X, KeyBlock_Y);
            //вешаем на него двежение
            $(`#blockMenuKey-${0}`).draggable({
                containment: "#main",
                scroll: false,
            });
            $(`#remove-blockMenuKey-${0}`).click(function (e) {
                maxKeyWordsBlock = -1;
                countOfDeletedKey += 1;
                console.log('blockCountKey remove', 0);
                e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();
            });
        }
        $(`#addItemMenu-blockMenuKey-${0}`).click(function (e) {
            countSubMenuKeyWord += 1;
            addSubMenuKeyWord('#ContainerSubMenuKeyWord', 'SubMenuKeyWords-' + countSubMenuKeyWord);
            console.log('countSubMenuKeyWord', countSubMenuKeyWord);


            $(`#addKeyWord-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];
                console.log(numID);
                countKeyword += 1;
                addWordKey('#ContainerKeyWords-SubMenuKeyWords-' + numID, 'KeyWords-' + countKeyword);
                console.log('KeyWords add', countSubMenuKeyWord);


                $(`#remove-KeyWords-${countKeyword}`).click(function (e) {
                    let numID = e.currentTarget.id.split('-')[2];
                    console.log('KeyWords remove', numID);
                    e.currentTarget.parentElement.parentElement.remove();


                });
            });
            $(`#remove-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];
                console.log('KeyWords remove', numID);
                e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();


            });

            // ///Вешаем обработчик возможно пристыкавываетля
            // $(`#addArrowBTN-menuItem-${countKeyword}`).click(function (e) {
            //     docking = e.currentTarget.id;
            // });

        });

        //Вешаем обработчик возможно пристыкавываетля
        $(`#addArrowBTN-menuItemKey-${countMenuItemKey}`).click(function (e) {
            docking = e.currentTarget.id;
        });
        for (let i = 0; i < newIDSubmenu; i++) {
            console.log("this");
            let index = i;
            countSubMenuKeyWord += 1;
            addSubMenuKeyWord('#ContainerSubMenuKeyWord', 'SubMenuKeyWords-' + index);
            $(`#addKeyWord-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];
                console.log(numID);
                countKeyword += 1;
                addWordKey('#ContainerKeyWords-SubMenuKeyWords-' + numID, 'KeyWords-' + countKeyword);
                console.log('KeyWords add', countSubMenuKeyWord);

                $(`#remove-KeyWords-${countKeyword}`).click(function (e) {
                    let numID = e.currentTarget.id.split('-')[2];

                    console.log('KeyWords remove', numID);
                    e.currentTarget.parentElement.parentElement.remove();


                });
            });
            $(`#remove-SubMenuKeyWords-${countSubMenuKeyWord}`).click(function (e) {
                let numID = e.currentTarget.id.split('-')[2];

                console.log('KeyWords remove', numID);
                e.currentTarget.parentElement.parentElement.parentElement.parentElement.remove();


            });
            let KeyWordsCount = JSONparse.KeyWordBlocks["SubMenu_KeyWordBlock_" + index].count_KeyWordThisBlock;
            for (let j = 0; j < KeyWordsCount; j++) {
                countKeyword += 1;
                addWordKey('#ContainerKeyWords-SubMenuKeyWords-' + countSubMenuKeyWord, 'KeyWords-' + countKeyword);
                $(`#remove-KeyWords-${countKeyword}`).click(function (e) {
                    let numID = e.currentTarget.id.split('-')[2];

                    console.log('KeyWords remove', numID);
                    e.currentTarget.parentElement.parentElement.remove();


                });
            }
        }

    });

</script>
</div>


</div>
</body>
</body>
</html>

